(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{352:function(t,e,s){"use strict";s.r(e);var a=s(1),_=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("问题")]),t._v(" "),e("p",[t._v("K8s中 Service 是怎么将Pod服务的端口?")])]),t._v(" "),e("h3",{attrs:{id:"iptables-的四表五链"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#iptables-的四表五链"}},[t._v("#")]),t._v(" iptables 的四表五链")]),t._v(" "),e("h4",{attrs:{id:"四表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四表"}},[t._v("#")]),t._v(" 四表")]),t._v(" "),e("blockquote",[e("p",[t._v("iptables 的四个表 iptable_filter，iptable_mangle，iptable_nat，iptable_raw，默认表filter（没有指定表的时候就是filter表）。")])]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("filter 表")]),t._v("：\n"),e("ul",[e("li",[t._v("用来对数据包进行过滤，具体的规则要求决定如何处理一个数据包。")]),t._v(" "),e("li",[t._v("对应的内核模块为："),e("code",[t._v("iptable_filter")]),t._v("，其表内包括三个链："),e("code",[t._v("input")]),t._v("、"),e("code",[t._v("forward")]),t._v("、"),e("code",[t._v("output")]),t._v(";")])])]),t._v(" "),e("li",[e("strong",[t._v("nat 表")]),t._v("：\n"),e("ul",[e("li",[t._v("nat 全称：network address translation 网络地址转换，主要用来修改数据包的 IP 地址、端口号信息。")]),t._v(" "),e("li",[t._v("对应的内核模块为："),e("code",[t._v("iptable_nat")]),t._v("，其表内包括三个链："),e("code",[t._v("prerouting")]),t._v("、"),e("code",[t._v("postrouting")]),t._v("、"),e("code",[t._v("output")]),t._v(";\n")])])]),t._v(" "),e("li",[t._v("mangle 表：\n"),e("ul",[e("li",[t._v("主要用来修改数据包的服务类型，生存周期，为数据包设置标记，实现流量整形、策略路由等。")]),t._v(" "),e("li",[t._v("对应的内核模块为："),e("code",[t._v("iptable_mangle")]),t._v("，其表内包括五个链："),e("code",[t._v("prerouting")]),t._v("、postrouting"),e("code",[t._v("、")]),t._v("input"),e("code",[t._v("、")]),t._v("output"),e("code",[t._v("、")]),t._v("forward`;")])])]),t._v(" "),e("li",[e("strong",[t._v("raw 表")]),t._v("：\n"),e("ul",[e("li",[t._v("主要用来决定是否对数据包进行状态跟踪。")]),t._v(" "),e("li",[t._v("对应的内核模块为："),e("code",[t._v("iptable_raw")]),t._v("，其表内包括两个链："),e("code",[t._v("output")]),t._v("、"),e("code",[t._v("prerouting")]),t._v(";")])])])]),t._v(" "),e("h4",{attrs:{id:"五链"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#五链"}},[t._v("#")]),t._v(" 五链")]),t._v(" "),e("blockquote",[e("p",[t._v("iptables 的五个链 PREROUTING，INPUT，FORWARD，OUTPUT，POSTROUTING。")])]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("input 链")]),t._v("：当收到访问防火墙本机地址的数据包时，将应用此链中的规则；")]),t._v(" "),e("li",[e("strong",[t._v("output 链")]),t._v("：当防火墙本机向外发送数据包时，将应用此链中的规则；")]),t._v(" "),e("li",[e("strong",[t._v("forward 链")]),t._v("：当收到需要通过防火中转发给其他地址的数据包时，将应用此链中的规则，注意如果需要实现forward转发需要开启Linux内核中的ip_forward功能；")]),t._v(" "),e("li",[e("strong",[t._v("prerouting 链")]),t._v("：在对数据包做路由选择之前，将应用此链中的规则；")]),t._v(" "),e("li",[e("strong",[t._v("postrouting 链")]),t._v("：在对数据包做路由选择之后，将应用此链中的规则；")])]),t._v(" "),e("h3",{attrs:{id:"iptables-的工作原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#iptables-的工作原理"}},[t._v("#")]),t._v(" iptables 的工作原理")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://lfm-image-1258982381.cos.ap-shanghai.myqcloud.com/image/iptables-1.png",alt:"Netfilter挂载点"}})]),t._v(" "),e("h4",{attrs:{id:"iptables-的配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#iptables-的配置"}},[t._v("#")]),t._v(" iptables 的配置")]),t._v(" "),e("p",[t._v("在了解清楚iptables的工作原理和每个表以及链的作用之后，我们就可以根据其特点进行针对性的配置。")]),t._v(" "),e("p",[t._v("iptables 的基本语法命令格式")]),t._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v(" iptables [-t 表名] 管理选项 [链名] [匹配条件] [-j 控制类型]\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("ul",[e("li",[t._v("表名、链名：指定"),e("code",[t._v("iptables")]),t._v("命令所操作的"),e("code",[t._v("表")]),t._v("和"),e("code",[t._v("链")]),t._v("，未指定表名时将默认使用"),e("code",[t._v("filter")]),t._v("表；")]),t._v(" "),e("li",[t._v("管理选项：表示"),e("code",[t._v("iptables")]),t._v("规则的操作方式，比如："),e("code",[t._v("插入")]),t._v("、"),e("code",[t._v("增加")]),t._v("、"),e("code",[t._v("删除")]),t._v("、"),e("code",[t._v("查看")]),t._v("等；")]),t._v(" "),e("li",[t._v("匹配条件：指定要处理的数据包的特征，不符合指定条件的数据包不处理；")]),t._v(" "),e("li",[t._v("控制类型：指数据包的处理方式，比如："),e("code",[t._v("允许accept")]),t._v("、"),e("code",[t._v("拒绝reject")]),t._v("、"),e("code",[t._v("丢弃drop")]),t._v("、"),e("code",[t._v("日志LOG")]),t._v("等；")])]),t._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v(" iptables 命令的常用管理选项\n -A:在指定链的末尾添加一条新的规则\n -D:删除指定链中的某一条规则，可删除指定序号或具体内容\n -I:在指定链中插入一条新规则，未指定序号时默认作为第一条规则\n -R:修改、替换指定链中的某一条规则，可指定规则序号或具体内容\n -L:列出指定链中所有的规则，未指定链名，则列出表中的所有链\n -F:清空指定链中所有的规则，未指定链名，则清空表中的所有链\n -P:设置指定链的默认策略\n -n:使用数字形式显示输出结果\n -v:查看规则列表时显示详细的信息\n -h:查看命令帮助信息\n --line-numbers:查看规则列表时，同时显示规则在链中的顺序号\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br")])]),e("h3",{attrs:{id:"参考资料"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("https://www.cnblogs.com/zllong/p/7236881.html")])]),t._v(" "),e("li",[e("p",[t._v("https://www.netfilter.org/")])]),t._v(" "),e("li",[e("p",[t._v("http://ipset.netfilter.org/iptables.man.html#index")])]),t._v(" "),e("li",[e("p",[t._v("https://www.thegeekstuff.com/2011/01/iptables-fundamentals/")])])])])}),[],!1,null,null,null);e.default=_.exports}}]);